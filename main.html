<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Relat√≥rio DIPEN/PP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        input, textarea, select { font-size: 16px !important; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        @keyframes slideIn { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .toast-enter { animation: slideIn 0.3s ease-out forwards; }
        
        /* Estilo para remover bot√£o de input file padr√£o */
        input[type="file"] { display: none; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans min-h-screen pb-24">

    <!-- Header -->
    <header class="bg-slate-800 border-b border-slate-700 p-4 sticky top-0 z-10 shadow-lg">
        <div class="flex items-center justify-between max-w-md mx-auto">
            <div class="flex items-center gap-3">
                <div class="bg-red-700 p-2 rounded-lg">
                    <i class="fa-solid fa-building-shield text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-sm font-bold text-white tracking-wide">DIPEN / POL√çCIA PENAL</h1>
                    <p class="text-xs text-slate-400">Gerador Padr√£o SSPS</p>
                </div>
            </div>
            <button onclick="resetForm()" class="text-slate-400 hover:text-red-400 transition-colors text-sm bg-slate-700/50 p-2 rounded-md">
                <i class="fa-solid fa-trash-can"></i>
            </button>
        </div>
    </header>

    <main class="p-4 max-w-md mx-auto space-y-4">

        <!-- Sele√ß√£o do Tipo de Opera√ß√£o -->
        <div class="bg-slate-800 rounded-xl p-4 border-l-4 border-red-600 shadow-md">
            <label class="block text-xs text-red-400 font-bold uppercase mb-2">Tipo de Opera√ß√£o üö®</label>
            <select id="tipoOperacao" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white focus:border-red-500 focus:outline-none font-bold">
                <option value="REVISTA GERAL">REVISTA GERAL</option>
                <option value="REVISTA PONTUAL">REVISTA PONTUAL</option>
                <option value="MBA">MBA</option>
            </select>
        </div>

        <!-- Bloco 1: Dados B√°sicos -->
        <div class="bg-slate-800 rounded-xl p-4 shadow-sm border border-slate-700 space-y-3">
            <div class="flex items-center gap-2 mb-1 text-slate-300 font-semibold text-sm">
                <i class="fa-solid fa-location-dot text-blue-400"></i> Localiza√ß√£o e Dados
            </div>
            
            <div>
                <label class="block text-xs text-slate-400 mb-1">1 ‚Äì EP (Estabelecimento Penal)</label>
                <input type="text" id="ep" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none">
            </div>

            <div>
                <label class="block text-xs text-slate-400 mb-1">2 ‚Äì Local (Galeria/Cela/Setor)</label>
                <input type="text" id="local" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none">
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="block text-xs text-slate-400 mb-1">3 ‚Äì Total do EP</label>
                    <input type="number" id="totalEp" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-xs text-slate-400 mb-1">4 ‚Äì OrCrim</label>
                    <input type="text" id="orcrim" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none">
                </div>
            </div>
        </div>

        <!-- Bloco 2: Tempo -->
        <div class="bg-slate-800 rounded-xl p-4 shadow-sm border border-slate-700 space-y-3">
            <div class="flex items-center gap-2 mb-1 text-slate-300 font-semibold text-sm">
                <i class="fa-regular fa-clock text-blue-400"></i> Cronologia
            </div>
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="block text-xs text-slate-400 mb-1">5 ‚Äì Data</label>
                    <input type="date" id="data" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none text-sm">
                </div>
                <div>
                    <label class="block text-xs text-slate-400 mb-1">6 ‚Äì Entrada (HH:MM)</label>
                    <input type="time" id="horaEntrada" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none">
                </div>
            </div>
             <div>
                <label class="block text-xs text-slate-400 mb-1">13 ‚Äì T√©rmino da opera√ß√£o (HH:MM)</label>
                <input type="time" id="horaTermino" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none">
            </div>
        </div>

        <!-- Bloco 3: Objetivos -->
        <div class="bg-slate-800 rounded-xl p-4 shadow-sm border border-slate-700 space-y-3">
            <div>
                <label class="block text-xs text-slate-400 mb-1">7 ‚Äì Finalidade</label>
                <input type="text" id="finalidade" placeholder="Ex: Manuten√ß√£o da ordem" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none">
            </div>
            <div>
                <label class="block text-xs text-slate-400 mb-1">8 ‚Äì Objetivo</label>
                <input type="text" id="objetivo" placeholder="Ex: Busca de il√≠citos" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none">
            </div>
        </div>

        <!-- Bloco 4: Pessoal -->
        <div class="bg-slate-800 rounded-xl p-4 shadow-sm border border-slate-700 space-y-3">
            <div>
                <label class="block text-xs text-slate-400 mb-1">9 ‚Äì Efetivo funcional</label>
                <textarea id="efetivo" rows="3" placeholder="Liste os servidores..." class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none"></textarea>
            </div>
            
            <div>
                <div class="flex justify-between items-end mb-1">
                    <label class="block text-xs text-slate-400">10 ‚Äì Presos transferidos</label>
                    <button onclick="setNaoAplica('presos')" class="text-[10px] bg-slate-700 px-2 py-1 rounded hover:bg-slate-600 transition">N√£o se aplica</button>
                </div>
                <textarea id="presos" rows="2" placeholder="Nomes / Quantidade" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none"></textarea>
            </div>
        </div>

        <!-- Bloco 5: Il√≠citos (Lista Inteligente) -->
        <div class="bg-slate-800 rounded-xl p-4 shadow-sm border border-slate-700">
            <div class="flex items-center gap-2 mb-3 text-slate-300 font-semibold text-sm">
                <i class="fa-solid fa-ban text-red-500"></i> 11 - Il√≠citos apreendidos
            </div>
            <p class="text-xs text-slate-500 mb-3">Preencha apenas o que foi apreendido. Deixe em branco o que n√£o houve.</p>
            
            <div class="grid grid-cols-2 gap-2">
                <!-- Itens -->
                <div class="bg-slate-900 p-2 rounded border border-slate-700/50">
                    <label class="text-[10px] uppercase text-slate-400 font-bold block mb-1">Maconha</label>
                    <input type="text" data-ilicito="MACONHA" placeholder="Qtd" class="w-full bg-slate-800 text-white text-sm p-1 rounded border-none focus:ring-1 focus:ring-red-500">
                </div>
                <div class="bg-slate-900 p-2 rounded border border-slate-700/50">
                    <label class="text-[10px] uppercase text-slate-400 font-bold block mb-1">Coca√≠na</label>
                    <input type="text" data-ilicito="COCA√çNA" placeholder="Qtd" class="w-full bg-slate-800 text-white text-sm p-1 rounded border-none focus:ring-1 focus:ring-red-500">
                </div>
                <div class="bg-slate-900 p-2 rounded border border-slate-700/50">
                    <label class="text-[10px] uppercase text-slate-400 font-bold block mb-1">Crack</label>
                    <input type="text" data-ilicito="CRACK" placeholder="Qtd" class="w-full bg-slate-800 text-white text-sm p-1 rounded border-none focus:ring-1 focus:ring-red-500">
                </div>
                <div class="bg-slate-900 p-2 rounded border border-slate-700/50">
                    <label class="text-[10px] uppercase text-slate-400 font-bold block mb-1">Celular</label>
                    <input type="text" data-ilicito="CELULAR" placeholder="Qtd" class="w-full bg-slate-800 text-white text-sm p-1 rounded border-none focus:ring-1 focus:ring-red-500">
                </div>
                <div class="bg-slate-900 p-2 rounded border border-slate-700/50">
                    <label class="text-[10px] uppercase text-slate-400 font-bold block mb-1">Chip</label>
                    <input type="text" data-ilicito="CHIP" placeholder="Qtd" class="w-full bg-slate-800 text-white text-sm p-1 rounded border-none focus:ring-1 focus:ring-red-500">
                </div>
                <div class="bg-slate-900 p-2 rounded border border-slate-700/50">
                    <label class="text-[10px] uppercase text-slate-400 font-bold block mb-1">Arma Branca</label>
                    <input type="text" data-ilicito="ARMA BRANCA" placeholder="Qtd" class="w-full bg-slate-800 text-white text-sm p-1 rounded border-none focus:ring-1 focus:ring-red-500">
                </div>
                <div class="bg-slate-900 p-2 rounded border border-slate-700/50">
                    <label class="text-[10px] uppercase text-slate-400 font-bold block mb-1">Arma de Fogo</label>
                    <input type="text" data-ilicito="ARMA DE FOGO" placeholder="Qtd" class="w-full bg-slate-800 text-white text-sm p-1 rounded border-none focus:ring-1 focus:ring-red-500">
                </div>
                <div class="bg-slate-900 p-2 rounded border border-slate-700/50">
                    <label class="text-[10px] uppercase text-slate-400 font-bold block mb-1">Muni√ß√£o</label>
                    <input type="text" data-ilicito="MUNI√á√ÉO" placeholder="Qtd" class="w-full bg-slate-800 text-white text-sm p-1 rounded border-none focus:ring-1 focus:ring-red-500">
                </div>
                <div class="col-span-2 bg-slate-900 p-2 rounded border border-slate-700/50">
                    <label class="text-[10px] uppercase text-slate-400 font-bold block mb-1">Outros</label>
                    <input type="text" data-ilicito="OUTROS" placeholder="Descreva..." class="w-full bg-slate-800 text-white text-sm p-1 rounded border-none focus:ring-1 focus:ring-red-500">
                </div>
            </div>
        </div>

        <!-- Bloco 6: Informa√ß√µes Finais -->
        <div class="bg-slate-800 rounded-xl p-4 shadow-sm border border-slate-700">
            <div class="flex items-center gap-2 mb-3 text-slate-300 font-semibold text-sm">
                <i class="fa-solid fa-circle-info text-blue-400"></i> 12 - Informa√ß√µes relevantes
            </div>
            <textarea id="infos" rows="5" placeholder="Descri√ß√£o do fato..." class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 focus:border-blue-500 focus:outline-none"></textarea>
        </div>

        <!-- Bloco de C√¢mera -->
        <div class="bg-slate-800 rounded-xl p-4 shadow-sm border border-slate-700">
            <div class="flex items-center gap-2 mb-3 text-slate-300 font-semibold text-sm">
                <i class="fa-solid fa-camera text-blue-400"></i> Fotos / Anexos
            </div>
            
            <!-- Input de arquivo oculto -->
            <input type="file" id="cameraInput" accept="image/*" capture="environment" onchange="handleCamera(this)">
            
            <button onclick="document.getElementById('cameraInput').click()" class="w-full bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 border-dashed rounded-lg p-6 flex flex-col items-center justify-center gap-2 transition-all active:scale-95">
                <i class="fa-solid fa-camera-retro text-3xl text-slate-400"></i>
                <span class="text-sm text-slate-400 font-medium">Toque para tirar foto</span>
            </button>

            <!-- Galeria de miniaturas -->
            <div id="gallery" class="grid grid-cols-3 gap-2 mt-4 empty:hidden"></div>
        </div>

        <!-- Bot√£o Gerar -->
        <button onclick="gerarRelatorio()" class="w-full bg-gradient-to-r from-red-700 to-red-600 hover:from-red-600 hover:to-red-500 text-white font-bold py-4 px-6 rounded-xl shadow-lg transform transition active:scale-95 flex items-center justify-center gap-2 text-lg uppercase tracking-wider">
            <i class="fa-solid fa-file-shield"></i> Gerar Relat√≥rio
        </button>

        <!-- √Årea de Preview -->
        <div id="previewArea" class="hidden mt-6 bg-slate-950 rounded-xl border border-slate-700 overflow-hidden">
            <div class="bg-slate-900 p-3 border-b border-slate-700 flex justify-between items-center">
                <span class="text-sm font-semibold text-slate-300">Pr√©-visualiza√ß√£o</span>
                <span class="text-xs text-slate-500">Edit√°vel</span>
            </div>
            <textarea id="textoFinal" class="w-full h-96 bg-slate-950 p-4 text-slate-300 focus:outline-none font-mono text-sm leading-relaxed resize-none"></textarea>
            
            <div class="grid grid-cols-2 gap-0 border-t border-slate-700">
                <button onclick="copiarTexto()" class="bg-slate-800 hover:bg-slate-700 text-slate-200 py-4 font-semibold flex items-center justify-center gap-2 border-r border-slate-700 transition-colors">
                    <i class="fa-regular fa-copy"></i> Copiar
                </button>
                <button onclick="compartilharZap()" class="bg-green-600 hover:bg-green-500 text-white py-4 font-bold flex items-center justify-center gap-2 transition-colors">
                    <i class="fa-brands fa-whatsapp text-xl"></i> Enviar
                </button>
            </div>
        </div>

    </main>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl border border-slate-600 flex items-center gap-3 hidden z-50 min-w-[200px] justify-center">
        <i id="toastIcon" class="fa-solid fa-check-circle text-green-400"></i>
        <span id="toastMsg" class="font-medium">Copiado!</span>
    </div>

    <script>
        let storedFiles = []; // Array para armazenar as fotos

        // Inicializa√ß√£o
        window.onload = function() {
            setDates();
        };

        function setDates() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            document.getElementById('data').value = `${year}-${month}-${day}`;
            
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('horaEntrada').value = `${hours}:${minutes}`;
        }

        function setNaoAplica(id) {
            document.getElementById(id).value = "N√ÉO SE APLICA";
        }

        // Fun√ß√µes da C√¢mera
        function handleCamera(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                storedFiles.push(file); // Adiciona ao array
                
                // Cria miniatura
                const reader = new FileReader();
                reader.onload = function(e) {
                    const div = document.createElement('div');
                    div.className = "relative group aspect-square bg-slate-900 rounded-lg overflow-hidden border border-slate-700";
                    
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = "w-full h-full object-cover";
                    
                    const btn = document.createElement('button');
                    btn.innerHTML = '<i class="fa-solid fa-times"></i>';
                    btn.className = "absolute top-1 right-1 bg-red-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs shadow-md opacity-90 hover:opacity-100";
                    btn.onclick = function() {
                        // Remove do array e do DOM
                        const index = storedFiles.indexOf(file);
                        if (index > -1) storedFiles.splice(index, 1);
                        div.remove();
                    };

                    div.appendChild(img);
                    div.appendChild(btn);
                    document.getElementById('gallery').appendChild(div);
                };
                reader.readAsDataURL(file);
                
                // Limpa o input para permitir tirar a mesma foto novamente se necess√°rio
                input.value = '';
            }
        }

        function gerarRelatorio() {
            // Coleta de dados b√°sicos
            const tipoOp = document.getElementById('tipoOperacao').value;
            const ep = document.getElementById('ep').value || "";
            const local = document.getElementById('local').value || "";
            const totalEp = document.getElementById('totalEp').value || "";
            const orcrim = document.getElementById('orcrim').value || "";
            
            // Data
            let dataRaw = document.getElementById('data').value;
            let dataFmt = dataRaw ? dataRaw.split('-').reverse().join('/') : "";
            
            const horaEntrada = document.getElementById('horaEntrada').value || "";
            const finalidade = document.getElementById('finalidade').value || "";
            const objetivo = document.getElementById('objetivo').value || "";
            const efetivo = document.getElementById('efetivo').value || "";
            const presos = document.getElementById('presos').value || "";
            const infos = document.getElementById('infos').value || "";
            const horaTermino = document.getElementById('horaTermino').value || "";

            // Coleta de Il√≠citos
            let ilicitosTexto = "";
            const inputsIlicitos = document.querySelectorAll('input[data-ilicito]');
            let itensEncontrados = [];

            inputsIlicitos.forEach(input => {
                if (input.value.trim() !== "") {
                    const nome = input.getAttribute('data-ilicito');
                    const qtd = input.value;
                    itensEncontrados.push(`${nome}: ${qtd}`);
                }
            });

            if (itensEncontrados.length > 0) {
                ilicitosTexto = itensEncontrados.join("\n");
            } else {
                ilicitosTexto = "NADA CONSTA";
            }

            // Constru√ß√£o do Template (exatamente como pedido)
            const template = `‚ö†Ô∏è DIPEN/DIPEN/POL√çCIA PENAL/SSPS‚ö†Ô∏è
¬†
üö® ${tipoOp} üö®
¬†
1 ‚Äì EP: ${ep}
2 - Local: ${local}
3 - Total do EP: ${totalEp}
4 - OrCrim: ${orcrim}
5 ‚Äì Data: ${dataFmt}
6 ‚Äì Hor√°rio de entrada: ${horaEntrada}
7 - Finalidade: ${finalidade}
8 - Objetivo: ${objetivo}
9 - Efetivo funcional:
${efetivo}

10 - Presos transferidos: ${presos}

11- Il√≠citos apreendidos:
${ilicitosTexto}

12 - Informa√ß√µes relevantes:
${infos}

13 - T√©rmino da opera√ß√£o: ${horaTermino}`;

            // Renderizar
            const previewArea = document.getElementById('previewArea');
            const textoFinal = document.getElementById('textoFinal');
            
            textoFinal.value = template;
            previewArea.classList.remove('hidden');
            previewArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            showToast("Relat√≥rio gerado!", "success");
        }

        // Fun√ß√µes de copiar e reset
        function copiarTexto() {
            const texto = document.getElementById('textoFinal');
            texto.select();
            texto.setSelectionRange(0, 99999);
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(texto.value)
                    .then(() => showToast("Copiado!"))
                    .catch(() => fallbackCopy(texto));
            } else {
                fallbackCopy(texto);
            }
        }

        function fallbackCopy(texto) {
            try {
                document.execCommand('copy');
                showToast("Copiado!");
            } catch (err) {
                showToast("Erro ao copiar", "error");
            }
        }

        async function compartilharZap() {
            const texto = document.getElementById('textoFinal').value;
            if (!texto) { showToast("Gere primeiro!", "error"); return; }

            // Tenta Compartilhamento Nativo com Arquivos (N√≠vel 2 do Web Share API)
            // Isso funciona na maioria dos Androids e iOS modernos (Chrome/Safari)
            if (navigator.canShare && navigator.share && storedFiles.length > 0) {
                try {
                    // Verifica se o navegador suporta os arquivos especificos
                    if (navigator.canShare({ files: storedFiles })) {
                        await navigator.share({
                            text: texto,
                            files: storedFiles
                        });
                        showToast("Enviado com sucesso!");
                        return;
                    }
                } catch (err) {
                    console.log("Compartilhamento nativo falhou ou cancelado", err);
                    // Se falhar, continua para o m√©todo de texto apenas
                }
            }
            
            // Aviso se houver arquivos mas o navegador n√£o suportar envio direto
            if (storedFiles.length > 0) {
                alert("Aten√ß√£o: Este navegador n√£o permite anexar as fotos automaticamente ao WhatsApp.\n\nO texto ser√° aberto, mas voc√™ precisar√° selecionar as fotos manualmente na sua galeria.");
            }

            const url = `https://wa.me/?text=${encodeURIComponent(texto)}`;
            window.open(url, '_blank');
        }

        function resetForm() {
            if(confirm("Limpar tudo?")) {
                document.querySelectorAll('input, textarea').forEach(el => el.value = '');
                storedFiles = []; // Limpa fotos
                document.getElementById('gallery').innerHTML = '';
                document.getElementById('previewArea').classList.add('hidden');
                setDates();
                showToast("Limpo", "success");
            }
        }

        function showToast(message, type = "success") {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = message;
            const icon = document.getElementById('toastIcon');
            
            if (type === "error") icon.className = "fa-solid fa-circle-exclamation text-red-400";
            else icon.className = "fa-solid fa-check-circle text-green-400";

            toast.classList.remove('hidden');
            toast.classList.add('toast-enter');
            setTimeout(() => {
                toast.classList.add('hidden');
                toast.classList.remove('toast-enter');
            }, 3000);
        }
    </script>
</body>
</html>
